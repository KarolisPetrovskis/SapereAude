openapi: 3.0.4
info:
  title: Commerce Backend API (diagram-derived, updated)
  description: API contract derived from the provided class diagram. Includes Product/ProductGroup/ProductVariation, Orders, Reservations, Discounts, TaxRates, Businesses and Users.
  version: 1.0.1
servers:
  - url: https://api.example.com/v1

security:
  - bearerAuth: []
tags:
  - name: Auth
    description: Authentication operations
  - name: Product
    description: Product, ProductVariation, ProductGroup operations
  - name: Order
    description: Orders, order items and payments
  - name: Business
    description: Business and User operations
  - name: Reservation
    description: Reservation operations
  - name: Discount
    description: Discount operations
  - name: Tax
    description: Tax rate operations

paths:
  /auth/login:
    post:
      tags: [Auth]
      summary: User login
      security: []  
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
              required: [email, password]
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: JWT Bearer token
                  user:
                    $ref: '#/components/schemas/GetUsers'
                  firstLogin:
                    type: boolean
                    description: Indicates if this is the user's first login
        '401':
          description: Invalid credentials
        '500':
          $ref: '#/components/responses/InternalError'

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
              required: [refreshToken]
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
        '401':
          description: Invalid refresh token

  /auth/logout:
    post:
      tags: [Auth]
      summary: User logout
      responses:
        '204':
          description: Logged out successfully

  /products:
    get:
      tags: [Product]
      summary: List products
      parameters:
        - name: businessId
          in: query
          schema:
            type: string
            format: uuid
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductWithVariations'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      tags: [Product]
      summary: Create product with variations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductWithVariations'
        '400':
          description: Invalid input
        '422':
          description: Validation error

  /products/{productId}:
    parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    get:
      tags: [Product]
      summary: Get product by id with all variation details
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductWithVariations'
        '404':
          description: Product not found

    put:
      tags: [Product]
      summary: Update existing product
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductCreate'
      responses:
        '200':
          description: Product updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductWithVariations'
        '404':
          description: Product not found

  /products/{productId}/status:
    parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    put:
      tags: [Product]
      summary: Change product status
      description: Change product status between Available, Unavailable, and Removed
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  $ref: '#/components/schemas/ProductStatus'
              required: [status]
      responses:
        '200':
          description: Status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductWithVariations'
        '404':
          description: Product not found


  /orders:
    post:
      tags: [Order]
      summary: Create a new order
      operationId: createOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderCreateRequest'
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'

    get:
      tags: [Order]
      summary: Get all orders
      operationId: listOrders
      responses:
        '200':
          description: List of orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrderResponse'

  /orders/{orderId}:
    get:
      tags: [Order]
      summary: Get order by ID
      operationId: getOrderById
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'

    put:
      tags: [Order]
      summary: Update order status or request
      operationId: updateOrder
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderUpdateRequest'
      responses:
        '200':
          description: Order updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'

  /orders/{orderId}/items:
    parameters:
      - name: orderId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Order]
      summary: List items for an order
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrderItem'
    post:
      tags: [Order]
      summary: Add item to order
      operationId: addOrderItem
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderItemCreateRequest'
      responses:
        '201':
          description: Item added to order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderItemResponse'

  /orders/{orderId}/items/{itemId}:
    delete:
      tags: [Order]
      summary: Remove an item from order
      operationId: removeOrderItem
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: itemId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Item removed

  /order-payments:
    post:
      tags: [Order]
      summary: Create a payment for an order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderPaymentCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderPayment'
        '400':
          description: Invalid input

  /businesses:
    get:
      tags: [Business]
      summary: List businesses
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Business'
    post:
      tags: [Business]
      summary: Create business
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BusinessCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Business'

  /businesses/{businessId}/Users:
    parameters:
      - name: businessId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Business]
      summary: List Users for a business
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GetUsers'
    post:
      tags: [Business]
      summary: Create a User under a business
      description: Creates a new user with auto-generated one-time password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/GetUsers'
                  temporaryPassword:
                    type: string
                    description: One-time password that must be changed on first login


  /businesses/{businessId}/Users/{UserId}:
    parameters:
      - name: businessId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: UserId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    
    get:
      tags: [Business]
      summary: Get user details
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetUsers'
        '404':
          description: User not found
    
    put:
      tags: [Business]
      summary: Update user details
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetUsers'
        '404':
          description: User not found

  /reservations:
    get:
      tags: [Reservation]
      summary: List reservations for a business
      parameters:
        - name: businessId
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: ID of the business to retrieve reservations for
        - name: customerId
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: Optional filter to show only reservations by a specific customer
        - name: fromDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Optional start date to filter reservations
        - name: toDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Optional end date to filter reservations
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReservationDetail'
        '404':
          description: No reservations found
    post:
      tags: [Reservation]
      summary: Create reservation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservationCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Reservation'

  /discounts:
    get:
      tags: [Discount]
      summary: List discounts
      parameters:
        - name: businessId
          in: query
          schema:
            type: string
            format: uuid
        - name: productId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Discount'
    post:
      tags: [Discount]
      summary: Create discount
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DiscountCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Discount'

  /discounts/{discountId}:
    parameters:
      - name: discountId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    
    get:
      tags: [Discount]
      summary: Get discount by ID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Discount'
        '404':
          description: Discount not found
    
    put:
      tags: [Discount]
      summary: Update discount
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DiscountCreate'
      responses:
        '200':
          description: Discount updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Discount'
        '404':
          description: Discount not found
    
    delete:
      tags: [Discount]
      summary: Delete discount
      responses:
        '204':
          description: Deleted
        '404':
          description: Discount not found

  /taxRates:
    get:
      tags: [Tax]
      summary: Get tax rate
      parameters:
        - name: taxId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaxRate'
    post:
      tags: [Tax]
      summary: Create tax rate (business-scoped)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaxRateCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaxRate'

  /orders/info/{orderId}:
    parameters:
      - name: orderId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Order]
      summary: Get full order details by ID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderFullDetail'
        '404':
          description: Order not found
  /reservations/by-period:
    get:
      tags: [Reservation]
      summary: Get reservations for a business within a specified time period
      parameters:
        - name: businessId
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: Business ID to retrieve reservations for
        - name: fromDate
          in: query
          required: true
          schema:
            type: string
            format: date-time
          description: Start date-time (inclusive)
        - name: toDate
          in: query
          required: true
          schema:
            type: string
            format: date-time
          description: End date-time (inclusive)
      responses:
        '200':
          description: List of reservations within the given period
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Reservation'
        '400':
          description: Invalid or missing date range
        '404':
          description: No reservations found for the given business and period

  /businesses/{businessId}/Users/{UserId}/salary:
    put:
      tags: [User]
      summary: Update User salary
      description: >
        Updates the salary of a specific User under the given business.
        Only authorized users (e.g., business managers) should be able to perform this operation.
      parameters:
        - name: businessId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID of the business the User belongs to
        - name: UserId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID of the User whose salary will be updated
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                newSalary:
                  type: number
                  format: decimal
                  description: New salary amount
              required: [newSalary]
      responses:
        '200':
          description: Salary updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Invalid salary input
        '404':
          description: Business or User not found

  /products/{productId}/tax:
    get:
      tags: [Tax]
      summary: Get tax rate for a specific product
      description: |
        Returns the applicable tax rate for a product. 
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: The ID of the product to retrieve tax information for
      responses:
        '200':
          description: Tax rate found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaxRate'
        '404':
          description: Product or tax rate not found

  /Users/{UserId}/orders:
    get:
      tags: [Order]
      summary: Get all orders created or handled by a specific User
      description: |
        Retrieves a list of all orders associated with a given User.
      parameters:
        - name: UserId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID of the User whose orders to retrieve
        - name: status
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/OrderStatus'
          description: Filter by order status (e.g., Pending, Completed)
        - name: fromDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Optional start date to filter orders
        - name: toDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Optional end date to filter orders
      responses:
        '200':
          description: List of orders handled by the User
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
        '404':
          description: User not found or no orders available

  /Users/{UserId}/permission:
    put:
      tags: [User]
      summary: Update a User's permission level
      description: |
        Updates the access or permission level of a specific User.
        This can be used by business administrators to promote or restrict User privileges.
      parameters:
        - name: UserId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID of the User whose permission level will be updated
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                permissionLevel:
                  type: string
                  enum: [Owner, Manager, Employee, Trainee]
                  description: The new permission level to assign
              required: [permissionLevel]
      responses:
        '200':
          description: Permission level updated successfully
        '400':
          description: Invalid permission level
        '404':
          description: User not found

  /Users/{UserId}/password:
    put:
      tags: [User]
      summary: Reset user password (auto-generates new password)
      description: |
        Generates a new one-time password for the user. 
        For employee users: can only be performed by a manager.
        User must change the password on next login.
      parameters:
        - name: UserId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID of the User whose password is being reset
      responses:
        '200':
          description: Password reset successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  temporaryPassword:
                    type: string
                    description: New one-time password
        '404':
          description: User not found

  /Users/{UserId}/reservations/current:
    get:
      tags: [Reservation]
      summary: Get current and upcoming reservations for a User
      description: |
        Retrieves all reservations assigned to a specific User that are currently active
        or scheduled for the future.
      parameters:
        - name: UserId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID of the User whose reservations to retrieve
        - name: fromDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Optional start of the period (defaults to now)
        - name: toDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Optional end of the period
      responses:
        '200':
          description: List of current and upcoming reservations for the User
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Reservation'
        '404':
          description: User not found or no reservations available

  /taxRates/{taxRateId}:
    put:
      tags: [Tax]
      summary: Update an existing tax rate
      description: |
        Updates the details of a tax rate
        Used by business administrators when tax regulations or pricing rules change.
      parameters:
        - name: taxRateId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: The ID of the tax rate to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                value:
                  type: number
                  format: decimal
                effectiveFrom:
                  type: string
                  format: date-time
                  description: epoch
                effectiveTo:
                  type: string
                  format: date-time
                  description: epoch
                  nullable: true
                country:
                  type: string
                region:
                  type: string
                  nullable: true
      responses:
        '200':
          description: Tax rate updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaxRate'
        '400':
          description: Invalid request body
        '404':
          description: Tax rate not found

  /productVariationGroups:
    post:
      tags: [ProductVariationGroup]
      summary: Create a new product variation group
      description: Creates a group to organize related product variations.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                  nullable: true
                businessId:
                  type: string
                  format: uuid
              required: [name, businessId]
      responses:
        '201':
          description: Group created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductVariationGroup'
        '400':
          description: Invalid input

  /productVariationGroups/{groupId}:
    delete:
      tags: [ProductVariationGroup]
      summary: Delete a product variation group
      description: Deletes a product variation group. This will also remove all variations from this group.
      parameters:
        - name: groupId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Group deleted successfully
        '404':
          description: Group not found
        '409':
          description: Cannot delete group that is in use by products

  /productVariationGroups/{groupId}/variations:
    post:
      tags: [ProductVariationGroup]
      summary: Add a product variation to a group
      parameters:
        - name: groupId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductVariation'

      responses:
        '200':
          description: Variation added successfully
        '404':
          description: Group or variation not found

  /productVariationGroups/{groupId}/variations/{variationId}:
    delete:
      tags: [ProductVariationGroup]
      summary: Remove a product variation from a group
      parameters:
        - name: groupId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: variationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Variation removed successfully
        '404':
          description: Group or variation not found

  /Users/{userId}/FirstLogIn/password:
    put:
      tags: [User]
      summary: Change password on first login
      description: |
        Allows a user to set their permanent password on first login using the temporary password.
        When successful, `firstLogin` is automatically set to `false`.
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                temporaryPassword:
                  type: string
                  description: The temporary password provided by the system
                newPassword:
                  type: string
                  minLength: 8
                  description: The new permanent password
              required: [temporaryPassword, newPassword]
      responses:
        '200':
          description: Password updated successfully; firstLogin set to false
        '400':
          description: Invalid password format
        '401':
          description: Incorrect temporary password
        '404':
          description: User not found

  /businesses/{businessId}/places:
    get:
      tags: [Place]
      summary: List all places for a specific business
      description: |
        Retrieves all places
        that belong to the specified business.
      parameters:
        - name: businessId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: The ID of the business whose places to list
      responses:
        '200':
          description: List of places for the business
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Place'
        '404':
          description: Business not found

    post:
      tags: [Place]
      summary: Create a new place for a specific business
      description: |
        Creates a new place (such as a table or room)
        under the specified business.
      parameters:
        - name: businessId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: The business ID this place will belong to
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlaceCreate'
      responses:
        '201':
          description: Place created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Place'
        '400':
          description: Invalid input
        '404':
          description: Business not found

  /businesses/{businessId}/places/{placeId}:
    parameters:
      - name: businessId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: placeId
        in: path
        required: true
        schema:
          type: string
          format: uuid

    get:
      tags: [Place]
      summary: Get details of a place in a specific business
      responses:
        '200':
          description: Place found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Place'
        '404':
          description: Place not found

    put:
      tags: [Place]
      summary: Update a place in a business
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlaceUpdate'
      responses:
        '200':
          description: Place updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Place'
        '400':
          description: Invalid input
        '404':
          description: Place not found

    delete:
      tags: [Place]
      summary: Delete a place from a business
      responses:
        '204':
          description: Place deleted successfully
        '404':
          description: Place not found

  /places/{placeId}/reservations:
    get:
      tags: [Reservation]
      summary: Get all reservations for a specific place
      description: Retrieves all reservations associated with the given place.
      parameters:
        - name: placeId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of reservations for the place
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Reservation'
        '404':
          description: Place not found

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /auth/login endpoint

  responses:
    InternalError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    # Product & related
    Product:
      type: object
      properties:
        id:
          type: string
          format: uuid
        businessId:
          type: string
          format: uuid
        name:
          type: string
        price:
          type: number
          format: decimal
        description:
          type: string
          nullable: true
        productVariationGroupId:
          type: string
          format: uuid
          nullable: true
        productStatus:
          $ref: '#/components/schemas/ProductStatus'
        tax:
          type: string
          format: uuid
      required: [id, businessId, price, name, tax, productStatus]

    ProductWithVariations:
      allOf:
        - $ref: '#/components/schemas/Product'
        - type: object
          properties:
            variationGroup:
              type: object
              nullable: true
              properties:
                id:
                  type: string
                  format: uuid
                group:
                  type: string
                variations:
                  type: array
                  items:
                    $ref: '#/components/schemas/ProductVariation'

    ProductCreate:
      type: object
      properties:
        businessId:
          type: string
          format: uuid
        name:
          type: string
        price:
          type: number
          format: decimal
        description:
          type: string
          nullable: true
        tax:
          type: string
          format: uuid
        variationGroup:
          type: object
          nullable: true
          description: Optional variation group with all variations to create
          properties:
            group:
              type: string
              description: Name of the variation group (e.g., "Milk type", "Coffee beans")
            variations:
              type: array
              items:
                type: object
                properties:
                  option:
                    type: string
                    description: Variation option name (e.g., "Almond", "Coconut")
                  priceModifier:
                    type: number
                    format: decimal
                    description: Price adjustment for this variation
                required: [option, priceModifier]
          required: [group, variations]
      required: [businessId, name, price, tax]

    ProductVariationGroup:
      type: object
      properties:
        id:
          type: string
          format: uuid
        productVariationId:
          type: array
          items:
            type: string
            format: uuid
        group:
          type: string
      required: [id, productVariationId, group]

    ProductVariation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        option:
          type: string
        priceModifier:
          type: number
          format: decimal
      required: [id, priceModifier, option]

    # Orders & items & payments
    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
        UserId:
          type: string
          format: uuid
        orderItemId:
          type: array
          items:
            type: string
            format: uuid
        businessId:
          type: string
          format: uuid
        discountId:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
        price:
          type: number
          format: decimal
        dateTime:
          type: string
          format: date-time
          description: epoch
        status:
          $ref: '#/components/schemas/OrderStatus'
        specialRequest:
          type: string
          nullable: true
      required: [id, UserId, businessId, dateTime, status, orderItemId, price]

    OrderCreateRequest:
      type: object
      required:
        - userId
        - items
      properties:
        userId:
          type: string
          format: uuid
        discountId:
          type: string
          format: uuid
          nullable: true
        specialRequest:
          type: string
          nullable: true
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItemCreateRequest'

    OrderItemCreateRequest:
      type: object
      required:
        - productId
        - amount
      properties:
        productId:
          type: string
          format: uuid
        productVariationGroup:
          type: array
          items:
            type: string
            format: uuid
        discountId:
          type: string
          nullable: true
          format: uuid
        amount:
          type: integer

    OrderItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        orderId:
          type: string
          format: uuid
        productId:
          type: string
          format: uuid
        discountId:
          type: string
          format: uuid
          nullable: true
        amount:
          type: integer
        price:
          type: number
          format: decimal
          default: 0
        isAltered:
          type: array
          items:
            type: boolean
        productVariationGroup:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
      required: [id, orderId, productId, amount, price, isAltered]

    OrderItemResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        orderId:
          type: string
          format: uuid
        productId:
          type: string
          format: uuid
        productVariationGroup:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
        discountId:
          type: string
          format: uuid
          nullable: true
        amount:
          type: integer
        price:
          type: number
          format: decimal
        isAltered:
          type: boolean
      required: [id, orderId, productId, amount, price]

    OrderResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        businesses:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
        discountId:
          type: string
          format: uuid
          nullable: true
        price:
          type: number
          format: decimal
        dateTime:
          type: integer
          format: epoch
        status:
          $ref: '#/components/schemas/OrderStatus'
        specialRequest:
          type: string
          nullable: true
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItemResponse'

    OrderUpdateRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/OrderStatus'
          description: Update order status (e.g. Pending -> Confirmed -> Completed)
        specialRequest:
          type: string
          nullable: true
          description: Customer request or note
        discountId:
          type: string
          format: uuid
          nullable: true
          description: Optional discount applied to order
      description: >
        Used to partially update an order. Does not allow modifying total price or items.

    OrderItemCreate:
      type: object
      properties:
        productId:
          type: string
          format: uuid
        orderId:
          type: string
          format: uuid
        amount:
          type: integer
        discountId:
          type: string
          format: uuid
          nullable: true
        isAltered:
          type: array
          items:
            type: boolean
        productVariationGroup:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
      required: [orderId, productId, amount, isAltered]

    OrderPayment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        orderId:
          type: string
          format: uuid
        products:
          type: array
          items:
            type: string
            format: uuid
        paymentSum:
          type: number
          format: decimal
        paymentType:
          $ref: '#/components/schemas/PaymentType'
        dateTime:
          type: string
          format: date-time
          description: epoch
        tip:
          type: number
          format: decimal
          nullable: true
      required: [id, orderId, paymentType, dateTime, products]

    OrderPaymentCreate:
      type: object
      properties:
        orderId:
          type: string
          format: uuid
        products:
          type: array
          items:
            type: string
            format: uuid
        paymentType:
          $ref: '#/components/schemas/PaymentType'
        tip:
          type: number
          format: decimal
          nullable: true
      required: [orderId, paymentType, products]

    Business:
      type: object
      properties:
        id:
          type: string
          format: uuid
        statistics:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
        name:
          type: string
        country:
          type: string
        address:
          type: string
        owner:
          type: string
        email:
          type: string
        phoneNumber:
          type: string
      required: [id, name, country, address, owner, email, phoneNumber]

    BusinessCreate:
      type: object
      properties:
        name:
          type: string
        country:
          type: string
        address:
          type: string
        owner:
          type: string
        email:
          type: string
        phoneNumber:
          type: string
      required: [name, country, address, owner, email, phoneNumber]

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        businessId:
          type: string
          format: uuid
        name:
          type: string
        surname:
          type: string
        salary:
          type: number
          format: decimal
          nullable: true
        employmentStatus:
          $ref: '#/components/schemas/UserStatus'
        permissionLevel:
          type: integer
        password:
          type: string
          format: password
          description: encrypted password
        firstLogin:
          type: boolean
      required:
        [
          id,
          name,
          surname,
          permissionLevel,
          businessId,
          employmentStatus,
          password,
          firstLogin,
        ]

    GetUsers:
      type: object
      properties:
        id:
          type: string
          format: uuid
        businessId:
          type: string
          format: uuid
        name:
          type: string
        surname:
          type: string
        salary:
          type: number
          format: decimal
          nullable: true
        employmentStatus:
          $ref: '#/components/schemas/UserStatus'
        permissionLevel:
          type: integer
      required:
        [id, name, surname, permissionLevel, businessId, employmentStatus]

    UserCreate:
      type: object
      properties:
        name:
          type: string
        surname:
          type: string
        permissionLevel:
          type: integer
        salary:
          type: number
          format: decimal
      required: [name, surname, permissionLevel, salary]

    UserUpdate:
      type: object
      properties:
        name:
          type: string
        surname:
          type: string
        salary:
          type: number
          format: decimal
          nullable: true
        employmentStatus:
          $ref: '#/components/schemas/UserStatus'
        permissionLevel:
          type: integer
      description: Update user details. All fields are optional.

    # Reservations
    Reservation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
          nullable: true
        businessId:
          type: string
          format: uuid
        productIds:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
        placeIds:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
        name:
          type: string
        phoneNumber:
          type: string
        numberOfPeople:
          type: integer
          nullable: true
        startTime:
          type: string
          format: date-time
          description: epoch
        endTime:
          type: string
          format: date-time
          description: epoch
        request:
          type: string
          nullable: true
      required: [id, userId, businessId, name, phoneNumber, startTime, endTime]

    ReservationCreate:
      type: object
      properties:
        userId:
          type: string
          format: uuid
          nullable: true
        businessId:
          type: string
          format: uuid
        productIds:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
        reservationPlace:
          type: array
          items:
            type: string
            format: uuid
          nullable: true
        name:
          type: string
        phoneNumber:
          type: string
        numberOfPeople:
          type: integer
          nullable: true
        startTime:
          type: string
          format: date-time
          description: epoch
        endTime:
          type: string
          format: date-time
          description: epoch
        request:
          type: string
          nullable: true
      required: [userId, businessId, name, phoneNumber, startTime, endTime]

    # Discounts
    Discount:
      type: object
      properties:
        id:
          type: string
          format: uuid
        businessId:
          type: string
          format: uuid
        productId:
          type: string
          format: uuid
          nullable: true
        startDate:
          type: string
          format: date-time
          description: epoch
        endDate:
          type: string
          format: date-time
          description: epoch
          nullable: true
        percentDiscount:
          type: boolean
        amount:
          type: number
          format: decimal
        individualItemDiscount:
          type: boolean
      required:
        [
          id,
          businessId,
          amount,
          percentDiscount,
          individualItemDiscount,
          startDate,
        ]

    DiscountCreate:
      type: object
      properties:
        businessId:
          type: string
          format: uuid
        productId:
          type: string
          format: uuid
        startDate:
          type: string
          format: date-time
          description: epoch
        endDate:
          type: string
          format: date-time
          description: epoch
        percentDiscount:
          type: boolean
        amount:
          type: number
          format: decimal
        individualItemDiscount:
          type: boolean
      required: [businessId, amount, individualItemDiscount, percentDiscount]

    # Tax rates
    TaxRate:
      type: object
      properties:
        id:
          type: string
          format: uuid
        value:
          type: number
          format: decimal
        effectiveFrom:
          type: string
          format: date-time
          description: epoch
        effectiveTo:
          type: string
          format: date-time
          description: epoch
          nullable: true
        country:
          type: string
        region:
          type: string
          nullable: true
      required: [id, value, effectiveFrom, country]

    TaxRateCreate:
      type: object
      properties:
        value:
          type: number
          format: decimal
        effectiveFrom:
          type: string
          format: date-time
          description: epoch
        effectiveTo:
          type: string
          format: date-time
          description: epoch
        country:
          type: string
        region:
          type: string
      required: [value, effectiveFrom, country]

    Place:
      type: object
      properties:
        id:
          type: string
          format: uuid
        placeNumber:
          type: integer
        type:
          $ref: '#/components/schemas/PlaceType'
      required: [id, placeNumber, type]

    PlaceCreate:
      type: object
      properties:
        name:
          type: string
        placeType:
          $ref: '#/components/schemas/PlaceType'
      required: [name, placeType]

    PlaceUpdate:
      type: object
      properties:
        name:
          type: string
        placeType:
          $ref: '#/components/schemas/PlaceType'

    OrderFullDetail:
      type: object
      properties:
        id:
          type: string
          format: uuid
        businessId:
          type: string
          format: uuid
        UserId:
          type: string
          format: uuid
        dateTime:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/OrderStatus'
        specialRequest:
          type: string
          nullable: true
        items:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              quantity:
                type: integer
              product:
                $ref: '#/components/schemas/Product'
              productVariation:
                $ref: '#/components/schemas/ProductVariation'
              price:
                type: number
                format: decimal
              discount:
                $ref: '#/components/schemas/Discount'
        totalBeforeDiscount:
          type: number
          format: decimal
        totalDiscount:
          type: number
          format: decimal
        totalAfterDiscount:
          type: number
          format: decimal
      required:
        [id, businessId, UserId, dateTime, status, items, totalAfterDiscount]

    ReservationDetail:
      type: object
      properties:
        id:
          type: string
          format: uuid
        businessId:
          type: string
          format: uuid
        name:
          type: string
        phoneNumber:
          type: string
        userId:
          type: string
          format: uuid
          nullable: true
        reservationDate:
          type: string
          format: date-time
        request:
          type: string
          nullable: true
      required: [id, businessId, name, phoneNumber, reservationDate]

    # Enums & common
    PaymentType:
      type: string
      enum: [Cash, Card, GiftCard]
    OrderStatus:
      type: string
      enum: [InProgress, Canceled, Paid, Refunded]

    UserStatus:
      type: string
      enum: [active, terminate]

    ProductStatus:
      type: string
      enum: [Available, Unavailable, Removed]

    PlaceType:
      type: string
      enum: [Table, Seat, Room]

    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
      required: [code, message]